# findql/tools

## findtojson.sh

Converts file info lines printed by `find` to JSON in flat or nested format

Flat format simply turns each line from `find` into a JSON record. This is useful is if you want to process `find` output as JSON.

Nested format creates the directory tree hierarchy from `find` output. This is useful if you want to simulate a filesystem as JSON trees.

The tool is very fast. It takes just a few seconds to get a JSON tree of over 100,000 files and directories.

Here's an example with 2 directories and 2 files as given to `find`

```
tree dir_0 dir_1 file_0.txt file_1.txt

dir_0
└── file_2.txt
dir_1
├── dir_10
└── file_3.txt
file_0.txt  [error opening dir]
file_1.txt  [error opening dir]

3 directories, 4 files
```

```
ls -lR dir_0 dir_1 file_0.txt file_1.txt

-rw-r--r-- 1 nobody nobody 39416 May 30 17:45 file_0.txt
-rw-r--r-- 1 nobody nobody 51536 May 30 17:45 file_1.txt

dir_0:
total 48
-rw-r--r-- 1 nobody nobody 45224 May 30 17:45 file_2.txt

dir_1:
total 60
drwxr-xr-x 2 nobody nobody  4096 May 30 17:46 dir_10
-rw-r--r-- 1 nobody nobody 55932 May 30 17:46 file_3.txt

dir_1/dir_10:
total 0
```

Flat output is just like output from `find` but as JSON records in `paths` array
```
findtojson.sh -f flat dir_0 dir_1 file_0.txt file_1.txt | jq
```
```json
{
  "header": { "msg": "Generated by findtojson.sh dir_0 dir_1 file_0.txt file_1.txt", "time": "2024-05-30_18:08:20.281102544", "timezone": "America/Chicago", "pwd": ".", "format": "flat", "debug": 0, "roots": [ "dir_0", "dir_1", "file_0.txt", "file_1.txt" ] },
  "paths": [
    { "index": 1, "depth": 0, "name": "dir_0", "atime": "2024-05-30_17:46:46.1786152840", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 2453, "links": 2, "mode": "0755", "mtime": "2024-05-30_17:45:41.8686430570", "path": "dir_0", "perm": "drwxr-xr-x", "size": 4096, "stime": "2024-05-30_17:45:41.8686430570", "type": "d", "uid": 1002, "user": "nobody" },
    { "index": 2, "depth": 1, "name": "file_2.txt", "atime": "2024-05-30_17:45:41.8686430570", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61712, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:45:41.8686430570", "path": "dir_0/file_2.txt", "perm": "-rw-r--r--", "size": 45224, "stime": "2024-05-30_17:45:41.8686430570", "type": "f", "uid": 1002, "user": "nobody" },
    { "index": 3, "depth": 0, "name": "dir_1", "atime": "2024-05-30_17:46:46.1786152840", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61328, "links": 3, "mode": "0755", "mtime": "2024-05-30_17:46:32.0086150220", "path": "dir_1", "perm": "drwxr-xr-x", "size": 4096, "stime": "2024-05-30_17:46:32.0086150220", "type": "d", "uid": 1002, "user": "nobody" },
    { "index": 4, "depth": 1, "name": "file_3.txt", "atime": "2024-05-30_17:46:32.0086150220", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61714, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:46:32.0086150220", "path": "dir_1/file_3.txt", "perm": "-rw-r--r--", "size": 55932, "stime": "2024-05-30_17:46:32.0086150220", "type": "f", "uid": 1002, "user": "nobody" },
    { "index": 5, "depth": 1, "name": "dir_10", "atime": "2024-05-30_17:46:46.1786152840", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61713, "links": 2, "mode": "0755", "mtime": "2024-05-30_17:46:19.0186280090", "path": "dir_1/dir_10", "perm": "drwxr-xr-x", "size": 4096, "stime": "2024-05-30_17:46:19.0186280090", "type": "d", "uid": 1002, "user": "nobody" },
    { "index": 6, "depth": 0, "name": "file_0.txt", "atime": "2024-05-30_08:40:41.7191116620", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 2454, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:45:21.0586484620", "path": "file_0.txt", "perm": "-rw-r--r--", "size": 39416, "stime": "2024-05-30_17:45:21.0586484620", "type": "f", "uid": 1002, "user": "nobody" },
    { "index": 7, "depth": 0, "name": "file_1.txt", "atime": "2024-05-30_17:45:29.2686501590", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61711, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:45:29.2686501590", "path": "file_1.txt", "perm": "-rw-r--r--", "size": 51536, "stime": "2024-05-30_17:45:29.2686501590", "type": "f", "uid": 1002, "user": "nobody" }
  ]
}
```

Nested output adds an `entries` array to each directory record - and files and directories are nested mirroring the filesystem traversed by `find`
```
findtojson.sh -f nested dir_0 dir_1 file_0.txt file_1.txt | jq
```
```json
{
  "header": { "msg": "Generated by findtojson.sh dir_0 dir_1 file_0.txt file_1.txt", "time": "2024-05-30_18:06:50.389204460", "timezone": "America/Chicago", "pwd": ".", "format": "nested", "debug": 0, "roots": [ "dir_0", "dir_1", "file_0.txt", "file_1.txt" ] },
  "roots": [
    { "index": 1, "depth": 0, "name": "dir_0", "atime": "2024-05-30_17:46:46.1786152840", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 2453, "links": 2, "mode": "0755", "mtime": "2024-05-30_17:45:41.8686430570", "path": "dir_0", "perm": "drwxr-xr-x", "size": 4096, "stime": "2024-05-30_17:45:41.8686430570", "type": "d", "uid": 1002, "user": "nobody",
      "entries": [
        { "index": 2, "depth": 1, "name": "file_2.txt", "atime": "2024-05-30_17:45:41.8686430570", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61712, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:45:41.8686430570", "path": "dir_0/file_2.txt", "perm": "-rw-r--r--", "size": 45224, "stime": "2024-05-30_17:45:41.8686430570", "type": "f", "uid": 1002, "user": "nobody" }
      ]
    },
    { "index": 3, "depth": 0, "name": "dir_1", "atime": "2024-05-30_17:46:46.1786152840", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61328, "links": 3, "mode": "0755", "mtime": "2024-05-30_17:46:32.0086150220", "path": "dir_1", "perm": "drwxr-xr-x", "size": 4096, "stime": "2024-05-30_17:46:32.0086150220", "type": "d", "uid": 1002, "user": "nobody",
      "entries": [
        { "index": 4, "depth": 1, "name": "file_3.txt", "atime": "2024-05-30_17:46:32.0086150220", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61714, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:46:32.0086150220", "path": "dir_1/file_3.txt", "perm": "-rw-r--r--", "size": 55932, "stime": "2024-05-30_17:46:32.0086150220", "type": "f", "uid": 1002, "user": "nobody" },
        { "index": 5, "depth": 1, "name": "dir_10", "atime": "2024-05-30_17:46:46.1786152840", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61713, "links": 2, "mode": "0755", "mtime": "2024-05-30_17:46:19.0186280090", "path": "dir_1/dir_10", "perm": "drwxr-xr-x", "size": 4096, "stime": "2024-05-30_17:46:19.0186280090", "type": "d", "uid": 1002, "user": "nobody", "entries": []
        }
      ]
    },
    { "index": 6, "depth": 0, "name": "file_0.txt", "atime": "2024-05-30_08:40:41.7191116620", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 2454, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:45:21.0586484620", "path": "file_0.txt", "perm": "-rw-r--r--", "size": 39416, "stime": "2024-05-30_17:45:21.0586484620", "type": "f", "uid": 1002, "user": "nobody" },
    { "index": 7, "depth": 0, "name": "file_1.txt", "atime": "2024-05-30_17:45:29.2686501590", "ctime": "_", "fstype": "ext4", "gid": 1002, "group": "nobody", "inum": 61711, "links": 1, "mode": "0644", "mtime": "2024-05-30_17:45:29.2686501590", "path": "file_1.txt", "perm": "-rw-r--r--", "size": 51536, "stime": "2024-05-30_17:45:29.2686501590", "type": "f", "uid": 1002, "user": "nobody" }
  ]
}
```

